<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Control Center</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; background: #eef2f5; color: #333; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 40px; border-radius: 12px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        h1 { margin-top: 0; color: #333; border-bottom: 2px solid #ddd; padding-bottom: 20px; }
        h2 { color: #007bff; margin-top: 30px; font-size: 1.2rem; text-transform: uppercase; letter-spacing: 1px; }
        
        .row { display: flex; gap: 20px; margin-bottom: 15px; }
        .col { flex: 1; }
        
        label { display: block; font-weight: 600; margin-bottom: 8px; font-size: 0.9rem; color: #555; }
        input, select, textarea { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 14px; background: #fafafa; }
        input:focus, textarea:focus { border-color: #007bff; outline: none; background: #fff; }
        
        /* Standard Buttons */
        .btn { background: #007bff; color: white; border: none; padding: 12px 25px; cursor: pointer; border-radius: 6px; font-size: 15px; font-weight: bold; transition: 0.2s; }
        .btn:hover { background: #0056b3; transform: translateY(-2px); }
        
        .btn-delete { background: #ff4d4d; padding: 8px 15px; font-size: 13px; margin-right: 5px; }
        .btn-delete:hover { background: #cc0000; }
        
        .btn-edit { background: #f39c12; padding: 8px 15px; font-size: 13px; }
        .btn-edit:hover { background: #d68910; }

        /* DANGER ZONE STYLES */
        .danger-zone { border: 2px solid #ffcccc; background: #fff5f5; padding: 20px; border-radius: 8px; margin-top: 50px; }
        .danger-title { color: #cc0000; margin-top: 0; display: flex; align-items: center; gap: 10px; }
        .btn-danger-large { background: #cc0000; color: white; border: none; padding: 15px 30px; cursor: pointer; border-radius: 6px; font-size: 16px; font-weight: bold; margin-right: 15px; }
        .btn-danger-large:hover { background: #990000; }
        .btn-warning-large { background: #e67e22; color: white; border: none; padding: 15px 30px; cursor: pointer; border-radius: 6px; font-size: 16px; font-weight: bold; margin-right: 15px; }
        .btn-warning-large:hover { background: #d35400; }

        /* Video List Grid */
        #videoList { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; margin-top: 20px; }
        .video-card { border: 1px solid #eee; padding: 15px; background: #fff; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .preview-box { width: 100%; height: 140px; background: #000; margin-bottom: 10px; border-radius: 4px; overflow: hidden; position: relative; }
        .preview-box iframe { width: 100%; height: 100%; border: none; pointer-events: none; }
        .v-title { font-weight: bold; margin-bottom: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    </style>
</head>
<body>

<div class="container">
    <h1>ðŸš€ Website Control Center</h1>

    <!-- SECTION 1: DESIGN -->
    <h2>1. Site Design & Theme</h2>
    <div class="row">
        <div class="col">
            <label>Website Name</label>
            <input type="text" id="siteName" placeholder="My Awesome Site">
        </div>
        <div class="col">
            <label>Select Theme</label>
            <select id="siteTheme">
                <option value="modern">Modern Dark (Netflix)</option>
                <option value="clean">Clean Light (YouTube)</option>
                <option value="neon">Neon Gamer (Cyberpunk)</option>
            </select>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <label>Background Image URL (Optional)</label>
            <input type="text" id="bgImage" placeholder="https://example.com/image.jpg">
        </div>
        <div class="col" style="display:flex; align-items:flex-end;">
            <button class="btn" onclick="saveSettings()" style="width:100%">Save Design Settings</button>
        </div>
    </div>

    <!-- SECTION 2: ADD CONTENT -->
    <hr style="margin: 40px 0; border: 0; border-top: 1px solid #eee;">
    <h2>2. Add New Video</h2>
    <div class="row">
        <div class="col">
            <label>Video Title</label>
            <input type="text" id="vidTitle" placeholder="e.g. My Gameplay Ep. 1">
        </div>
    </div>
    <div class="row">
        <div class="col">
            <label>Video Link (YouTube, MP4, or Embed Code)</label>
            <textarea id="vidInput" style="height:80px" placeholder="Paste YouTube link here for best results..."></textarea>
            <small style="color: green;">âœ” Tip: Use YouTube links for unlimited views. Avoid free hosting tools.</small>
        </div>
    </div>
    <button class="btn" onclick="addVideo()">+ Publish Video</button>

    <!-- SECTION 3: MANAGE -->
    <hr style="margin: 40px 0; border: 0; border-top: 1px solid #eee;">
    <h2>3. Manage Library</h2>
    <div id="videoList">Loading videos...</div>

    <!-- SECTION 4: EMERGENCY BUTTONS -->
    <div class="danger-zone">
        <h2 class="danger-title">âš  DANGER ZONE - Emergency Controls</h2>
        <p style="margin-bottom: 20px; color: #666;">These actions are permanent and real-time. Please be careful.</p>
        
        <button class="btn-warning-large" onclick="clearAllVideos()">Clear All Videos</button>
        <button class="btn-danger-large" onclick="factoryReset()">âš  FACTORY RESET (Delete Everything)</button>
    </div>

</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getDatabase, ref, set, push, onValue, remove, update } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCS8jC7EMA9qg84LF0qaqunhO0NRzhkp9c",
      authDomain: "games-7-98b09.firebaseapp.com",
      databaseURL: "https://games-7-98b09-default-rtdb.firebaseio.com",
      projectId: "games-7-98b09",
      storageBucket: "games-7-98b09.firebasestorage.app",
      messagingSenderId: "686134480926",
      appId: "1:686134480926:web:ac0b6814d4674766d65e0f"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // --- 1. INTELLIGENT CONVERTER ---
    function processLink(input) {
        input = input.trim();
        const ytPattern = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/;
        const ytMatch = input.match(ytPattern);
        if (ytMatch && ytMatch[1]) {
            return `<iframe src="https://www.youtube.com/embed/${ytMatch[1]}?rel=0&modestbranding=1" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`;
        }
        if (input.startsWith('<')) return input;
        return `<iframe src="${input}" frameborder="0" allowfullscreen></iframe>`;
    }

    // --- 2. SETTINGS ACTIONS ---
    window.saveSettings = function() {
        set(ref(db, 'settings'), {
            name: document.getElementById('siteName').value,
            theme: document.getElementById('siteTheme').value,
            bgImage: document.getElementById('bgImage').value
        });
        alert("âœ… Design settings saved!");
    }

    // --- 3. VIDEO ACTIONS ---
    window.addVideo = function() {
        const title = document.getElementById('vidTitle').value;
        const rawInput = document.getElementById('vidInput').value;
        if(!rawInput || !title) return alert("Please enter both a Title and a Link.");
        const processedHtml = processLink(rawInput);
        push(ref(db, 'videos'), {
            title: title,
            html: processedHtml,
            originalLink: rawInput,
            timestamp: Date.now()
        });
        document.getElementById('vidTitle').value = "";
        document.getElementById('vidInput').value = "";
        alert("âœ… Video Published!");
    }

    window.deleteVideo = function(key) {
        if(confirm("Are you sure you want to delete this video?")) {
            remove(ref(db, 'videos/' + key));
        }
    }

    window.editVideo = function(key, currentTitle) {
        const newTitle = prompt("Edit Title:", currentTitle);
        if(newTitle !== null) {
            update(ref(db, 'videos/' + key), { title: newTitle });
        }
    }

    // --- 4. EMERGENCY ACTIONS (NEW) ---
    
    // Clear only videos, keep settings
    window.clearAllVideos = function() {
        if(confirm("âš  Are you sure you want to delete ALL videos? This cannot be undone.")) {
            remove(ref(db, 'videos'))
                .then(() => alert("All videos have been deleted."))
                .catch((error) => alert("Error: " + error.message));
        }
    }

    // Wipe absolutely everything
    window.factoryReset = function() {
        const check = prompt("âš  SECURITY CHECK\nType 'DELETE' (in all caps) to confirm wiping the ENTIRE database (Settings + Videos).");
        if(check === "DELETE") {
            remove(ref(db, '/'))
                .then(() => {
                    alert("System Reset Complete. Database is empty.");
                    location.reload();
                })
                .catch((error) => alert("Error: " + error.message));
        } else {
            alert("Reset Cancelled. You must type 'DELETE' exactly.");
        }
    }

    // --- 5. LOAD DATA ---
    onValue(ref(db, 'settings'), (snapshot) => {
        const data = snapshot.val();
        if(data) {
            document.getElementById('siteName').value = data.name || "";
            document.getElementById('siteTheme').value = data.theme || "modern";
            document.getElementById('bgImage').value = data.bgImage || "";
        }
    });

    onValue(ref(db, 'videos'), (snapshot) => {
        const list = document.getElementById('videoList');
        list.innerHTML = "";
        const data = snapshot.val();
        if(data) {
            Object.keys(data).reverse().forEach(key => {
                const video = data[key];
                const card = document.createElement('div');
                card.className = 'video-card';
                card.innerHTML = `
                    <div class="v-title">${video.title}</div>
                    <div class="preview-box">${video.html}</div>
                    <div style="margin-top:10px;">
                        <button class="btn btn-delete" onclick="deleteVideo('${key}')">Delete</button>
                        <button class="btn btn-edit" onclick="editVideo('${key}', '${video.title.replace(/'/g, "\\'")}')">Edit Title</button>
                    </div>
                `;
                list.appendChild(card);
            });
        } else {
            list.innerHTML = "No videos yet.";
        }
    });
</script>
</body>
</html>